# 연습 모드 확장 — 기능 요구사항

> **최종 갱신**: 2026-01-30  
> **역할**: 연습 모드 기능의 **단일 진실(SoT)**  
> **우선순위**: MVP

---

## 1) 목적 / 사용자 시나리오

### 1.1 목적
- PracticePage에서 다양한 연습 모드를 선택하여 사용자 경험과 유지율을 향상
- 공통 타자 엔진을 재사용하고, 모드별 규칙(시간 제한, 오타 제한 등)만 교체
- 모든 모드는 동일한 결과 저장/조회 흐름을 따름

### 1.2 사용자 시나리오

| # | 시나리오 | 설명 |
|---|----------|------|
| 1 | 일반 문장 연습 | 사용자가 팩/난이도를 선택하고 문장을 순서대로 입력 |
| 2 | 타임어택 | 30/60/120초 동안 최대한 많이 입력, 시간 종료 시 자동 저장 |
| 3 | 정확도 챌린지 | 오타 N개 초과 시 종료, 높은 정확도 유지 목표 |
| 4 | 단어 연습 | 짧은 단어를 빠르게 반복 입력, 템포 훈련 |
| 5 | 한글 특화 드릴 | 받침/겹받침/띄어쓰기 등 패턴별 반복 훈련 |
| 6 | 약점 훈련 | 이전 결과의 오타 Top5 기반으로 추천 문장 연습 |

---

## 2) 화면(UX) 구성

### 2.1 모드 선택 화면 (PracticePage 진입)

```
┌─────────────────────────────────────────────────────────────┐
│  연습 모드 선택                                              │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │ 📝 문장 연습 │  │ ⏱️ 타임어택  │  │ 🎯 정확도   │         │
│  │ 팩/난이도   │  │ 30/60/120초 │  │ 오타 제한   │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │ 🔤 단어 연습 │  │ 🇰🇷 한글 드릴 │  │ 💪 약점 훈련 │         │
│  │ 템포 훈련   │  │ 받침/겹받침 │  │ 오타 기반   │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 설정 패널 (모드 선택 후)

| 요소 | 설명 |
|------|------|
| 언어 선택 | `ko` / `en` 라디오/드롭다운 |
| 난이도 선택 | 1~5 슬라이더 또는 버튼 |
| 문장팩 선택 | 드롭다운 (선택 사항) |
| 시간 제한 | 타임어택: 30/60/120초 선택 |
| 오타 제한 | 정확도 챌린지: 5/10/무제한 선택 |
| 문장 수 | 5/10/20개 선택 |
| **시작 버튼** | 설정 완료 후 연습 시작 |

### 2.3 연습 화면 (공통 레이아웃)

| 영역 | 요소 |
|------|------|
| 상단 | 모드명, 진행률 바, 남은 시간/문장 |
| 중앙 | 현재 문장/단어 표시, 커서, 정답/오답 하이라이트 |
| 하단 | 실시간 WPM, 정확도, 오타 수 |
| 컨트롤 | 일시정지, 다시시작, 종료 버튼 |

### 2.4 ResultPage (연습 완료 후)

| 요소 | 설명 |
|------|------|
| 요약 카드 | WPM, CPM, 정확도, 오타 수, 소요 시간 |
| 오타 Top5 | 자주 틀린 문자/조합 목록 |
| 추천 버튼 | "약점 훈련 시작" → 해당 패턴 훈련 진입 |
| 공유 버튼 | 결과 이미지 생성/공유 (Phase 2) |

---

## 3) 데이터/테이블 영향

### 3.1 기존 테이블 활용

| 테이블 | 용도 | 변경 |
|--------|------|------|
| `sessions_typing_session` | 모든 모드 결과 저장 | 변경 없음 (metadata 활용) |
| `texts_text_pack` | 모드별 콘텐츠 소스 | 변경 없음 |
| `texts_text_item` | 문장/단어 콘텐츠 | 변경 없음 |

### 3.2 metadata 필드 활용

```json
{
  "submode": "time_attack | sentence | word | accuracy_challenge | kor_drill | weakness_drill",
  "settings": {
    "time_limit_sec": 60,
    "max_errors": 5,
    "items_per_session": 10,
    "difficulty": 3,
    "strict_spacing": true,
    "drill_type": "batchim"
  },
  "result_extra": {
    "fail_reason": "max_errors | timeout | manual",
    "top_errors": ["ㅎ→ㄱ", "ㄴ→ㅁ"],
    "timeline": [{"t": 10, "wpm": 312.4}]
  }
}
```

### 3.3 추가 컬럼/인덱스 (필요 없음)

- `mode` 필드 기존 값: `practice`, `challenge`, `ranked`
- 세부 모드는 `metadata.submode`로 구분
- **인덱스 추가 불필요** (기존 인덱스로 충분)

### 3.4 콘텐츠 정합성

| 요구사항 | 해결 방안 |
|----------|----------|
| 단어 전용 팩 | `texts_text_pack` + `texts_text_item`으로 단어 팩 생성 |
| 한글 드릴 팩 | 받침/겹받침 패턴별 전용 팩 생성 (관리자 등록) |
| 약점 기반 추천 | ResultPage에서 오타 Top5 계산 → 연관 팩 추천 |

---

## 4) API 영향

### 4.1 기존 엔드포인트 (변경 없음)

| Method | Endpoint | 설명 |
|--------|----------|------|
| GET | `/api/texts/packs` | 팩 목록 (lang, difficulty 필터) |
| GET | `/api/texts/packs/{id}/items` | 문장/단어 아이템 |
| POST | `/api/sessions` | 세션 저장 |
| GET | `/api/sessions` | 세션 목록 (mode, lang, submode 필터) |

### 4.2 Request/Response 예시

#### POST /api/sessions (세션 저장)

**Request**
```json
{
  "pack_id": 123,
  "text_item_id": null,
  "mode": "practice",
  "language": "ko",
  "started_at": "2026-01-30T12:00:00Z",
  "ended_at": "2026-01-30T12:02:30Z",
  "duration_ms": 150000,
  "input_length": 500,
  "correct_length": 485,
  "error_count": 15,
  "accuracy": 97.00,
  "wpm": 345.20,
  "cpm": 1725.50,
  "metadata": {
    "submode": "time_attack",
    "settings": {
      "time_limit_sec": 60,
      "difficulty": 3
    },
    "result_extra": {
      "fail_reason": null,
      "top_errors": ["ㅎ→ㄱ", "ㄴ→ㅁ"]
    }
  }
}
```

**Response**
```json
{
  "id": 456,
  "user_id": 1,
  "created_at": "2026-01-30T12:02:31Z"
}
```

#### GET /api/sessions (필터 조회)

**Request**: `GET /api/sessions?mode=practice&lang=ko&submode=time_attack`

**Response**
```json
{
  "count": 25,
  "results": [
    {
      "id": 456,
      "mode": "practice",
      "language": "ko",
      "wpm": 345.20,
      "accuracy": 97.00,
      "metadata": {"submode": "time_attack", ...},
      "started_at": "2026-01-30T12:00:00Z"
    }
  ]
}
```

### 4.3 추가 엔드포인트 (Phase B)

| Method | Endpoint | 설명 | 우선순위 |
|--------|----------|------|----------|
| GET | `/api/insights/summary` | 오타/약점 요약 | Next |
| GET | `/api/training/recommendations` | 약점 기반 추천 | Next |

---

## 5) 구현 우선순위

### MVP (Phase A)

| # | 항목 | 예상 공수 |
|---|------|----------|
| 1 | 모드 선택 UI (PracticePage) | 4h |
| 2 | 공통 설정 폼 컴포넌트 | 3h |
| 3 | 문장 연습 고도화 (세트/팩/난이도) | 4h |
| 4 | 타임어택 모드 (시간 제한 규칙) | 2h |
| 5 | 정확도 챌린지 (오타 제한 규칙) | 2h |
| 6 | 단어 연습 (단어 전용 팩 + UI) | 4h |
| 7 | ResultPage 오타 Top5 표시 | 2h |

**총 예상**: 21h (약 3일)

### Next (Phase B)

| # | 항목 |
|---|------|
| 1 | 한글 특화 드릴 (드릴 전용 팩 + UI) |
| 2 | 약점 훈련 (오타 기반 추천) |
| 3 | 인사이트 API 연동 |

### Later (Phase C)

| # | 항목 |
|---|------|
| 1 | 데일리 챌린지 (`mode=challenge`) |
| 2 | 랭킹 레이스 (`mode=ranked`) |
| 3 | TypingEvent opt-in 저장 |

---

## 6) 엣지 케이스 / 실패 처리

### 6.1 타임어택

| 상황 | 처리 |
|------|------|
| 시간 종료 전 모든 문장 완료 | 다음 문장 자동 로딩 또는 조기 종료 선택 |
| 브라우저 탭 전환/비활성화 | 타이머 일시정지 알림 표시 |
| 네트워크 끊김 | 로컬 저장 후 재연결 시 동기화 |

### 6.2 정확도 챌린지

| 상황 | 처리 |
|------|------|
| 오타 제한 초과 | 즉시 종료 + 종료 사유 표시 |
| 마지막 문장에서 초과 | 결과 저장 시 `fail_reason` 기록 |

### 6.3 공통

| 상황 | 처리 |
|------|------|
| 비로그인 상태 | `user_id = NULL`로 저장, 로그인 시 이관 안내 |
| 세션 저장 실패 | 재시도 3회 → 로컬 저장 → 다음 접속 시 동기화 |
| 콘텐츠 로딩 실패 | 에러 메시지 + 재시도 버튼 |

---

## 7) 수용 기준 (Acceptance Criteria)

### 7.1 모드 선택 UI

- [ ] PracticePage 진입 시 6개 모드가 카드로 표시됨
- [ ] 모드 클릭 시 해당 설정 패널이 표시됨
- [ ] 설정 완료 후 시작 버튼으로 연습 화면 진입

### 7.2 타임어택

- [ ] 30/60/120초 선택 가능
- [ ] 타이머가 화면 상단에 실시간 표시
- [ ] 시간 종료 시 자동으로 결과 저장 및 ResultPage 이동
- [ ] `metadata.submode = "time_attack"` 저장 확인

### 7.3 정확도 챌린지

- [ ] 오타 제한 5/10/무제한 선택 가능
- [ ] 오타 수가 제한 초과 시 즉시 종료
- [ ] 종료 사유가 ResultPage에 표시
- [ ] `metadata.result_extra.fail_reason` 저장 확인

### 7.4 단어 연습

- [ ] 단어 전용 팩에서 콘텐츠 로딩
- [ ] 단어 입력 후 스페이스/엔터로 다음 단어 진행
- [ ] 30/50/100개 선택 가능

### 7.5 ResultPage 오타 분석

- [ ] 오타 Top5가 리스트로 표시
- [ ] "약점 훈련 시작" 버튼이 표시됨 (Phase B에서 기능 연결)

### 7.6 HistoryPage 필터

- [ ] `submode` 필터 추가 (타임어택/정확도챌린지 등)
- [ ] 필터된 결과가 정상 표시

---

## 관련 문서

- [프로젝트 마스터](../PROJECT_MASTER.md): 전체 현황
- [DB 스키마](../db/SCHEMA.md): 테이블 정의 (SoT)
- [추천 기능 로드맵](../roadmap/RECOMMENDED_FEATURES.md): Phase 1~3 로드맵
